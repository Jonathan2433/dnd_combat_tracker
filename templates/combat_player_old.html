{% extends "base.html" %}
{% block content %}

<h2>{{ combat.name }} â€” Round {{ combat.round }}</h2>

<!-- BARRE ACTION -->
        <div class="sticky-turn-bar">

            {% if combat.has_started %}
                <div class="live-chrono-bar">
                    <div>â± Combat : <span id="combat-timer">00:00</span></div>
                    <div>ğŸ” Round : <span id="round-timer">00:00</span></div>
                    <div>ğŸ¯ Tour : <span id="turn-timer">00:00</span></div>
                </div>
            {% endif %}

        </div>

<hr>

{% for c in combatants %}
<div class="combatant
    {% if loop.index0 == combat.current_turn %}active-turn{% endif %}
    {{ c.type|lower }}">

    <div class="combatant-header">
        <h3>
            {{ c.name }}
            {% if loop.index0 == combat.current_turn %}
                <span class="turn-badge">ğŸ¯ Tour en cours</span>
            {% endif %}
        </h3>
        <span class="initiative">Init {{ c.initiative }}</span>
    </div>

    <!-- âœ… PV visibles uniquement pour les PJ -->
    {% if c.type == "PJ" %}
        <div class="hp-bar-container">
            <div class="hp-bar"
                 style="width: {{ (c.hp_current / c.hp_max) * 100 }}%">
            </div>
        </div>

        <div>{{ c.hp_current }} / {{ c.hp_max }} PV</div>
    {% else %}
        <!-- âœ… Ennemi : seulement Ã©tat gÃ©nÃ©ral -->
        {% if c.is_dead %}
            <div class="dead">ğŸ’€ Mort</div>
        {% else %}
            <div>En forme</div>
        {% endif %}
    {% endif %}

    <!-- âœ… Conditions visibles -->
    {% if c.conditions %}
        <div class="conditions">
            {% for cond in c.conditions.split(",") %}
                <span class="condition-badge active-condition">
                    {{ cond }}
                </span>
            {% endfor %}
        </div>
    {% endif %}

</div>
{% endfor %}
    <!-- ========================= -->
    <!-- SIDEBAR INITIATIVE -->
    <!-- ========================= -->
    <div class="initiative-panel">
        <h3>ğŸ¯ Initiative</h3>

        <div class="initiative-list">
            {% for p in initiative_order %}
                <div class="initiative-card
                    {% if loop.index0 == combat.current_turn %}active-init{% endif %}
                    {% if p.is_dead %}dead-init{% endif %}">

                    <div>{{ p.name }}</div>
                    <div>Init {{ p.initiative }}</div>

                </div>
            {% endfor %}
        </div>
    </div>

</div>

{% endblock %}