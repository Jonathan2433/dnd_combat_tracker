{% extends "base.html" %}
{% block content %}

<h2>ğŸ“œ RÃ©sumÃ© du combat : {{ combat.name }}</h2>

<!-- ========================= -->
<!-- VUE Dâ€™ENSEMBLE -->
<!-- ========================= -->
<section class="card">
    <h3>ğŸ“Š Vue d'ensemble</h3>

    <p><strong>Rounds :</strong> {{ total_rounds }}</p>
    <p><strong>DurÃ©e totale du combat :</strong> {{ total_duration }}</p>
    <p><strong>Morts :</strong> {{ total_deaths }}</p>
    <p><strong>DÃ©gÃ¢ts totaux infligÃ©s :</strong> {{ total_damage }}</p>
    <p><strong>Soins totaux donnÃ©s :</strong> {{ total_heal }}</p>
</section>

<hr>

<!-- ========================= -->
<!-- STATISTIQUES PAR COMBATTANT -->
<!-- ========================= -->
<section class="card">
    <h3>âš”ï¸ Statistiques par combattant</h3>

    {% for stats in combatant_stats %}
    <div class="summary-combatant">

        <h4>
            {{ stats.name }}
            {% if stats.is_dead %}
                <span class="dead">ğŸ’€ Mort</span>
            {% endif %}
        </h4>

        <ul>
            <li>DÃ©gÃ¢ts infligÃ©s : {{ stats.damage_done }}</li>
            <li>DÃ©gÃ¢ts reÃ§us : {{ stats.damage_taken }}</li>
            <li>Soins donnÃ©s : {{ stats.heal_done }}</li>
            <li>Soins reÃ§us : {{ stats.heal_taken }}</li>
            <li>Ã‰tats appliquÃ©s : {{ stats.conditions_applied }}</li>
            <li>Ã‰tats subis : {{ stats.conditions_received }}</li>
            <li>Bonus CA appliquÃ©s : {{ stats.ac_bonus_given }}</li>
            <li>Temps total de tour : {{ stats.time_spent }}</li>
            <li><p><strong>En fuite :</strong> {{ total_fled }}</p></li>
        </ul>

    </div>
    {% endfor %}
</section>

<hr>

<!-- ========================= -->
<!-- TIMELINE AVEC CHRONOS -->
<!-- ========================= -->
<section class="card">
    <h3>ğŸ•’ Timeline du combat</h3>

    {% if timeline %}

        {% for round, turns in timeline.items() %}

            <div class="round-block">
                <h4>Round {{ round }} â€” {{ duration }}</h4>

                <!-- Tours du round -->
                {% for turn in turn_times.get(round, []) %}
                    <div>â–¶ {{ turn.actor }} â€” {{ turn.duration }}</div>
                {% endfor %}

                <!-- Actions dÃ©taillÃ©es -->
                {% for turn_owner, actions in turns.items() %}
                    <div class="turn-block">
                        <strong>Tour de {{ turn_owner }}</strong>
                        <ul>
                            {% for action in actions %}
                                <li>{{ action }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}

            </div>

        {% endfor %}

    {% else %}
        <p>Aucune action enregistrÃ©e pour ce combat.</p>
    {% endif %}

</section>

<hr>

<a href="{{ url_for('index') }}" class="btn-primary">
    â¬… Retour Ã  l'accueil
</a>

{% endblock %}